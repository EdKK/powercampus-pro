import React, { useMemo, useRef, useState } from "react";

// -----------------------------
// PowerCampus Pro — single-file React site
// - Tailwind classes for styling (no import needed in this canvas)
// - All in one page with anchored navigation
// - Image carousel, About, Research & Innovation, Events/Agenda,
//   Performance (Google Sheets/CSV), and Contact/Enroll form
//
// Notes for customization:
// 1) Replace the heroImages URLs with your own photos.
// 2) In the Performance section, paste a public Google Sheets URL
//    (File → Share → Publish to the web) to render inside the iframe.
// 3) CSV upload accepts simple comma-separated files exported from Excel/Sheets.
// 4) For the Contact form, set FORM_ENDPOINT to your Formspree/Email API endpoint.
// -----------------------------

const heroImages = [
  // Indoor & outdoor climbing — replace with your own URLs
  "https://images.unsplash.com/photo-1505852679233-d9fd70aff56d?q=80&w=1600&auto=format&fit=crop",
  "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1600&auto=format&fit=crop",
  "https://images.unsplash.com/photo-1513836279014-a89f7a76ae86?q=80&w=1600&auto=format&fit=crop",
];

const FORM_ENDPOINT = ""; // e.g., https://formspree.io/f/xxxxx (optional)

const Section = ({ id, title, subtitle, children }) => (
  <section id={id} className="scroll-mt-24 py-16 md:py-24">
    <div className="mx-auto max-w-6xl px-4">
      <header className="mb-8 md:mb-10">
        <h2 className="text-3xl md:text-4xl font-extrabold tracking-tight">{title}</h2>
        {subtitle && (
          <p className="mt-2 text-base md:text-lg text-gray-600">{subtitle}</p>
        )}
      </header>
      {children}
    </div>
  </section>
);

function useCarousel(length, intervalMs = 5000) {
  const [index, setIndex] = useState(0);
  const timerRef = useRef(null);
  React.useEffect(() => {
    timerRef.current = setInterval(() => {
      setIndex((i) => (i + 1) % length);
    }, intervalMs);
    return () => clearInterval(timerRef.current);
  }, [length, intervalMs]);
  return [index, setIndex];
}

function parseCSV(text) {
  // Minimal CSV parser (no quotes/escapes). Use for simple exports only.
  const rows = text
    .split(/\r?\n/)
    .map((r) => r.trim())
    .filter(Boolean)
    .map((r) => r.split(",").map((c) => c.trim()));
  const headers = rows[0] || [];
  const data = rows.slice(1).map((cells) => Object.fromEntries(headers.map((h, i) => [h, cells[i] ?? ""])));
  return { headers, data };
}

const Badge = ({ children }) => (
  <span className="inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium bg-white/70 backdrop-blur border-gray-200">
    {children}
  </span>
);

const Card = ({ children, className = "" }) => (
  <div className={`rounded-2xl shadow-sm ring-1 ring-gray-200 bg-white ${className}`}>{children}</div>
);

const Button = ({ children, className = "", ...props }) => (
  <button
    className={`rounded-2xl px-4 py-2 font-semibold shadow-sm ring-1 ring-gray-300 hover:shadow transition ${className}`}
    {...props}
  >
    {children}
  </button>
);

const Input = (props) => (
  <input
    {...props}
    className={`w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-800 ${props.className ?? ""}`}
  />
);

const Textarea = (props) => (
  <textarea
    {...props}
    className={`w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-800 ${props.className ?? ""}`}
  />
);

const Nav = () => {
  const [open, setOpen] = useState(false);
  const links = [
    { href: "#home", label: "Início" },
    { href: "#about", label: "Sobre" },
    { href: "#research", label: "Pesquisa" },
    { href: "#events", label: "Agenda" },
    { href: "#performance", label: "Performance" },
    { href: "#contact", label: "Contato" },
  ];
  return (
    <nav className="fixed top-0 inset-x-0 z-50 bg-white/80 backdrop-blur border-b border-gray-200">
      <div className="mx-auto max-w-6xl px-4 h-16 flex items-center justify-between">
        <a href="#home" className="flex items-center gap-2 font-black tracking-tight text-xl">
          <span className="inline-flex h-8 w-8 items-center justify-center rounded-xl bg-gray-900 text-white">PC</span>
          PowerCampus Pro
        </a>
        <div className="hidden md:flex items-center gap-6">
          {links.map((l) => (
            <a key={l.href} href={l.href} className="text-sm font-medium text-gray-700 hover:text-black">
              {l.label}
            </a>
          ))}
          <a href="#contact" className="ml-2">
            <Button className="bg-gray-900 text-white ring-gray-900">Inscreva-se</Button>
          </a>
        </div>
        <Button className="md:hidden" onClick={() => setOpen((o) => !o)} aria-label="Menu">
          ☰
        </Button>
      </div>
      {open && (
        <div className="md:hidden border-t border-gray-200">
          <div className="mx-auto max-w-6xl px-4 py-3 flex flex-col gap-2">
            {links.map((l) => (
              <a key={l.href} href={l.href} onClick={() => setOpen(false)} className="text-sm font-medium text-gray-700">
                {l.label}
              </a>
            ))}
          </div>
        </div>
      )}
    </nav>
  );
};

const Hero = () => {
  const [index] = useCarousel(heroImages.length, 5000);
  return (
    <section id="home" className="relative h-[80vh] md:h-[88vh] w-full">
      <div className="absolute inset-0 overflow-hidden rounded-b-[2.5rem]">
        {heroImages.map((src, i) => (
          <img
            key={src}
            src={src}
            alt="Climbing"
            className={`absolute inset-0 h-full w-full object-cover transition-opacity duration-700 ${
              i === index ? "opacity-100" : "opacity-0"
            }`}
          />
        ))}
        <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent" />
      </div>
      <div className="relative z-10 h-full flex items-end">
        <div className="mx-auto max-w-6xl px-4 pb-12 md:pb-16 text-white">
          <div className="flex items-center gap-2 mb-3">
            <Badge>Escalada indoor & outdoor</Badge>
            <Badge>Pesquisa aplicada</Badge>
            <Badge>Alto desempenho</Badge>
          </div>
          <h1 className="text-4xl md:text-6xl font-black leading-tight drop-shadow">
            PowerCampus Pro
          </h1>
          <p className="mt-3 md:mt-4 max-w-2xl text-lg md:text-xl text-white/90">
            Treinamento de escalada baseado em ciência: força, potência e técnica — do campus board ao pico.
          </p>
          <div className="mt-6 flex flex-wrap gap-3">
            <a href="#contact"><Button className="bg-white text-black">Agende uma aula experimental</Button></a>
            <a href="#research"><Button className="bg-black/40 text-white ring-white/40">Ver pesquisa & inovação</Button></a>
          </div>
        </div>
      </div>
    </section>
  );
};

const About = () => (
  <Section id="about" title="Sobre a PowerCampus Pro" subtitle="História, missão e quem está por trás">
    <div className="grid md:grid-cols-2 gap-6 md:gap-10 items-stretch">
      <Card className="p-6 md:p-8">
        <h3 className="text-xl font-bold mb-3">Nossa história</h3>
        <p className="text-gray-700 leading-relaxed">
          Há mais de 20 anos na escalada, a PowerCampus Pro nasceu do encontro entre experiência em competições
          e pesquisa acadêmica. Unimos prática e evidência científica para entregar metodologias de treino
          objetivas, mensuráveis e personalizadas para cada atleta.
        </p>
        <ul className="mt-4 grid grid-cols-2 gap-3 text-sm text-gray-700">
          <li>• Treinos periodizados</li>
          <li>• Testes de potência (Campus Board)</li>
          <li>• Monitoramento de carga</li>
          <li>• Preparação para campeonatos</li>
        </ul>
      </Card>
      <Card className="p-6 md:p-8 flex flex-col">
        <div className="flex items-center gap-4">
          <img src="https://images.unsplash.com/photo-1527980965255-d3b416303d12?q=80&w=400&auto=format&fit=crop" alt="Coach Kaka" className="h-20 w-20 rounded-2xl object-cover" />
          <div>
            <h3 className="text-xl font-bold">Kaka — PhD em Biomecânica</h3>
            <p className="text-gray-600 text-sm">Pesquisador na UFMG • Campeão em escalada • Treinador</p>
          </div>
        </div>
        <p className="mt-4 text-gray-700 leading-relaxed">
          Kaka é pesquisador doutor em Biomecânica do Esporte pela UFMG e referência em avaliação de força e
          potência em escaladores. Desenvolveu o PowerCB (Power Campus Board), protocolo e instrumentação
          para mensuração objetiva do desempenho dos membros superiores.
        </p>
        <div className="mt-4 flex flex-wrap gap-2">
          <Badge>Biomecânica</Badge>
          <Badge>Força & Potência</Badge>
          <Badge>Treinamento técnico</Badge>
        </div>
      </Card>
    </div>
  </Section>
);

const Research = () => (
  <Section id="research" title="Pesquisa & Inovação" subtitle="Testes de potência, métricas de campus board e transferência para a performance">
    <div className="grid md:grid-cols-3 gap-6">
      {[
        {
          t: "Teste de Potência (PowerCB)",
          d: "Avaliação padronizada com sensores e análise de força-velocidade para orientar cargas ótimas.",
        },
        {
          t: "Perfil Força–Velocidade",
          d: "Identifica se o atleta é mais ‘forte’ ou ‘rápido’ e ajusta o treino para maximizar a potência.",
        },
        {
          t: "Monitoramento & Feedback",
          d: "Integração de dados (vídeo, Força–Tempo, EMG) para decisões rápidas no planejamento.",
        },
      ].map((item) => (
        <Card key={item.t} className="p-6">
          <h3 className="text-lg font-bold mb-2">{item.t}</h3>
          <p className="text-gray-700 text-sm leading-relaxed">{item.d}</p>
        </Card>
      ))}
    </div>
    <Card className="p-6 md:p-8 mt-6">
      <h4 className="text-base md:text-lg font-semibold">Como funciona</h4>
      <ol className="mt-3 list-decimal pl-5 text-gray-700 space-y-1">
        <li>Anamnese & definição de metas.</li>
        <li>Testes no campus board (PowerCB) + análise de vídeo.</li>
        <li>Relatório com métricas-chave e plano de treino.</li>
        <li>Reavaliação periódica e ajuste fino das cargas.</li>
      </ol>
    </Card>
  </Section>
);

const sampleEvents = [
  { date: "2025-10-05", time: "18:30", title: "Aula experimental — Iniciantes", location: "Muro Indoor — Sala 2" },
  { date: "2025-10-07", time: "19:00", title: "Workshop: Perfil F–v no CB", location: "Laboratório — UFMG" },
  { date: "2025-10-10", time: "08:30", title: "Treino técnico — Dinâmicos", location: "Muro Outdoor" },
  { date: "2025-10-12", time: "17:30", title: "Reavaliação PowerCB", location: "Lab PowerCampus" },
];

const Events = () => {
  const [query, setQuery] = useState("");
  const filtered = useMemo(() => {
    const q = query.toLowerCase();
    return sampleEvents.filter(
      (e) => e.title.toLowerCase().includes(q) || e.location.toLowerCase().includes(q)
    );
  }, [query]);
  return (
    <Section id="events" title="Agenda de Treinos & Eventos" subtitle="Atualize esta lista com seus eventos reais ou integre com seu calendário">
      <div className="flex items-center gap-3 mb-4">
        <Input placeholder="Buscar por título ou local..." value={query} onChange={(e) => setQuery(e.target.value)} />
        <Badge>{filtered.length} itens</Badge>
      </div>
      <div className="grid gap-4 md:grid-cols-2">
        {filtered.map((e) => (
          <Card key={`${e.date}-${e.time}-${e.title}`} className="p-5">
            <div className="flex items-center justify-between">
              <div>
                <h4 className="font-semibold text-lg">{e.title}</h4>
                <p className="text-sm text-gray-600">{e.location}</p>
              </div>
              <div className="text-right">
                <div className="font-mono text-sm">{e.date}</div>
                <div className="font-mono text-xs text-gray-600">{e.time}</div>
              </div>
            </div>
          </Card>
        ))}
      </div>
      <p className="mt-4 text-sm text-gray-600">
        Dica: para integrar com Google Calendar, crie uma agenda pública e incorpore o iframe aqui.
      </p>
    </Section>
  );
};

const Performance = () => {
  const [sheetUrl, setSheetUrl] = useState("");
  const [csvMeta, setCsvMeta] = useState({ headers: [], data: [] });
  const inputRef = useRef(null);

  const onCSV = async (file) => {
    if (!file) return;
    const text = await file.text();
    const parsed = parseCSV(text);
    setCsvMeta(parsed);
  };

  return (
    <Section
      id="performance"
      title="Acompanhamento de Performance"
      subtitle="Conecte um Google Sheets público ou envie um CSV exportado do Excel para exibir métricas"
    >
      <div className="grid md:grid-cols-2 gap-6 items-start">
        <Card className="p-6">
          <h4 className="font-semibold mb-2">Integrar Google Sheets</h4>
          <p className="text-sm text-gray-600 mb-3">
            Publique sua planilha (Arquivo → Compartilhar → Publicar na Web) e cole a URL aqui.
          </p>
          <div className="flex gap-2">
            <Input placeholder="Cole a URL pública do Google Sheets" value={sheetUrl} onChange={(e) => setSheetUrl(e.target.value)} />
            <Button onClick={() => setSheetUrl(sheetUrl.trim())}>Carregar</Button>
          </div>
          {sheetUrl && (
            <div className="mt-4 aspect-video w-full overflow-hidden rounded-xl ring-1 ring-gray-200">
              <iframe title="Google Sheet" src={sheetUrl} className="h-full w-full" />
            </div>
          )}
        </Card>
        <Card className="p-6">
          <h4 className="font-semibold mb-2">Enviar CSV (Excel/Sheets)</h4>
          <p className="text-sm text-gray-600 mb-3">Selecione um .csv com cabeçalho na primeira linha.</p>
          <div className="flex gap-2 items-center">
            <Input type="file" accept=".csv" ref={inputRef} onChange={(e) => onCSV(e.target.files?.[0])} />
            <Button onClick={() => inputRef.current?.click()}>Escolher arquivo</Button>
          </div>
          {csvMeta.headers.length > 0 && (
            <div className="mt-4 overflow-auto">
              <table className="w-full text-sm">
                <thead>
                  <tr>
                    {csvMeta.headers.map((h) => (
                      <th key={h} className="text-left px-2 py-2 bg-gray-50 border-b">{h}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {csvMeta.data.map((row, idx) => (
                    <tr key={idx} className="odd:bg-white even:bg-gray-50">
                      {csvMeta.headers.map((h) => (
                        <td key={h} className="px-2 py-1 border-b">{row[h]}</td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </Card>
      </div>
    </Section>
  );
};

const Contact = () => {
  const [form, setForm] = useState({ name: "", email: "", message: "", plan: "Aula experimental" });
  const [status, setStatus] = useState(null);

  const submit = async (e) => {
    e.preventDefault();
    if (!form.name || !form.email) {
      setStatus({ ok: false, msg: "Preencha nome e e-mail." });
      return;
    }
    if (!FORM_ENDPOINT) {
      setStatus({ ok: true, msg: "✅ Simulação de envio concluída (defina FORM_ENDPOINT para enviar de verdade)." });
      return;
    }
    try {
      const res = await fetch(FORM_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(form),
      });
      if (!res.ok) throw new Error("Erro no envio");
      setStatus({ ok: true, msg: "✅ Mensagem enviada!" });
      setForm({ name: "", email: "", message: "", plan: "Aula experimental" });
    } catch (err) {
      setStatus({ ok: false, msg: "Falha ao enviar. Verifique sua conexão ou endpoint." });
    }
  };

  return (
    <Section id="contact" title="Contato & Inscrição" subtitle="Fale com a equipe e agende sua avaliação ou aula experimental">
      <div className="grid md:grid-cols-2 gap-6 items-start">
        <Card className="p-6 md:p-8">
          <form onSubmit={submit} className="space-y-3">
            <div>
              <label className="text-sm font-medium">Nome</label>
              <Input value={form.name} onChange={(e) => setForm({ ...form, name: e.target.value })} placeholder="Seu nome" />
            </div>
            <div>
              <label className="text-sm font-medium">E-mail</label>
              <Input type="email" value={form.email} onChange={(e) => setForm({ ...form, email: e.target.value })} placeholder="voce@email.com" />
            </div>
            <div>
              <label className="text-sm font-medium">Plano</label>
              <select
                className="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-800"
                value={form.plan}
                onChange={(e) => setForm({ ...form, plan: e.target.value })}
              >
                <option>Aula experimental</option>
                <option>Avaliação PowerCB</option>
                <option>Treinamento mensal</option>
                <option>Preparação para campeonato</option>
              </select>
            </div>
            <div>
              <label className="text-sm font-medium">Mensagem</label>
              <Textarea rows={4} value={form.message} onChange={(e) => setForm({ ...form, message: e.target.value })} placeholder="Conte seus objetivos e experiência" />
            </div>
            <div className="flex items-center gap-3">
              <Button type="submit" className="bg-gray-900 text-white ring-gray-900">Enviar</Button>
              {status && (
                <span className={`${status.ok ? "text-green-600" : "text-red-600"} text-sm`}>{status.msg}</span>
              )}
            </div>
          </form>
        </Card>
        <Card className="p-6 md:p-8">
          <h4 className="font-semibold mb-2">Endereço & Contatos</h4>
          <p className="text-gray-700">Laboratório PowerCampus — UFMG</p>
          <p className="text-gray-600 text-sm">Av. Pres. Antônio Carlos, 6627 — Pampulha, Belo Horizonte</p>
          <div className="mt-4 grid grid-cols-2 gap-3 text-sm">
            <div className="rounded-xl bg-gray-50 p-3">
              <div className="font-semibold">WhatsApp</div>
              <div className="text-gray-700">+55 (31) 9 0000-0000</div>
            </div>
            <div className="rounded-xl bg-gray-50 p-3">
              <div className="font-semibold">E-mail</div>
              <div className="text-gray-700">contato@powercampus.pro</div>
            </div>
          </div>
          <div className="mt-4 aspect-video w-full overflow-hidden rounded-xl ring-1 ring-gray-200">
            <iframe
              title="Mapa"
              src="https://www.google.com/maps?q=UFMG&output=embed"
              className="h-full w-full"
              loading="lazy"
            />
          </div>
        </Card>
      </div>
    </Section>
  );
};

export default function PowerCampusProSite() {
  return (
    <main className="font-sans text-gray-900">
      <Nav />
      <Hero />
      <About />
      <Research />
      <Events />
      <Performance />
      <Contact />
      <footer className="border-t border-gray-200 py-10">
        <div className="mx-auto max-w-6xl px-4 text-sm text-gray-600 flex flex-col md:flex-row items-center justify-between gap-3">
          <div>© {new Date().getFullYear()} PowerCampus Pro • Todos os direitos reservados</div>
          <div className="flex items-center gap-4">
            <a href="#about" className="hover:text-black">Sobre</a>
            <a href="#research" className="hover:text-black">Pesquisa</a>
            <a href="#contact" className="hover:text-black">Contato</a>
          </div>
        </div>
      </footer>
    </main>
  );
}

